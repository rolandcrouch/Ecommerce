{% extends 'base.html' %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        {% if product.image %}
            <img src="{{ product.image.url }}" class="img-fluid mb-3" alt="{{ product.name }}">
        {% endif %}
    </div>
    <div class="col-md-6">
        <h2>{{ product.name }}</h2>
        <p>{{ product.description }}</p>
        <p><strong>Price:</strong> ${{ product.price }}</p>
        {% if not user_is_vendor and not user_is_owner %}
        <form method="post" action="{% url 'add_to_basket' product.id %}"> 
            <div class="d-flex gap-2 mt-3">
                <form method="post" action="{% url 'add_to_basket' product.id %}" class="flex-fill">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-success w-100">Add to Basket</button>
                </form>
                <a href="{% url 'product_list' %}" class="btn btn-outline-secondary flex-fill w-100">← Back to products</a>
              </div>
        {% endif %}
    </div>
</div>

<hr>

<h4 class="mt-4">Customer Reviews</h4>
{% if reviews %}
  {% for review in reviews %}
    <div class="border p-3 mb-2">
      <div class="d-flex align-items-center mb-1">
        <strong>{{ review.user.username }}</strong>
        {% if review.is_verified %}
          <span class="badge bg-success ms-2" title="User has purchased before">Verified</span>
        {% else %}
          <span class="badge bg-secondary ms-2" title="No purchase history">Unverified</span>
        {% endif %}
        <span class="ms-2">— Rated: {{ review.rating }}/5</span>
      </div>

      <small class="text-muted">{{ review.created_at|date:"F j, Y" }}</small>

      {% if review.comment %}
        <p class="mt-2">{{ review.comment }}</p>
      {% endif %}
    </div>
  {% endfor %}
{% else %}
  <p>No reviews yet.</p>
{% endif %}

<hr>

{% if user.is_authenticated and not user_is_vendor and not user_is_owner %}
    <h5 class="mt-4">Leave a Review</h5>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary">Submit Review</button>
    </form>
{% elif user.is_authenticated and not user_is_vendor and not user_is_owner %}
    <p class="mt-3">Want to leave a review? <a href="{% url 'login' %}">Log in</a> first.</p>
{% endif %}

{% endblock %}
